---
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogPostItem from "@/components/common/BlogPostItem.astro";
import { getCollection } from "astro:content";
import { getBlogPosts } from "@/utils/blog";

export async function getStaticPaths() {
  const tags = await getCollection("tags");

  return tags.map((tag) => ({
    params: { slug: tag.data.slug },
    props: { tag },
  }));
}

const { tag } = Astro.props;
const posts = (await getBlogPosts()).filter((post) =>
  post.data.tags?.includes(tag.data.slug),
);
const postCount = posts.length;
---

<BaseLayout
  title={`标签：${tag.data.name} · chxuo.com`}
  description={`标签「${tag.data.name}」下的文章列表。`}
>
  <div class="mx-auto md:max-w-3xl">
    <section class="py-24 md:py-32">
      <div
        class="mb-8 flex flex-col justify-between gap-4 border-b border-border pb-6 md:flex-row md:items-end"
      >
        <div>
          <h1
            class="mb-2 font-serif text-3xl font-medium text-foreground md:text-4xl"
          >
            标签：{tag.data.name}
          </h1>
          <p class="font-sans text-sm text-muted-foreground">
            相关的文章都会贴上这个小标签。
          </p>
        </div>
        <p class="font-mono text-xs text-muted-foreground/80">
          共 {postCount} 篇文章
        </p>
      </div>

      {
        postCount === 0 ? (
          <p class="text-sm text-muted-foreground">
            暂时还没有打上这个标签的文章。
          </p>
        ) : (
          posts.map((post, index) => (
            <>
              <BlogPostItem post={post} />
              {index < posts.length - 1 && (
                <hr class="border-t border-border" />
              )}
            </>
          ))
        )
      }
    </section>
  </div>
</BaseLayout>
