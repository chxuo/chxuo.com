---
import Container from "@/components/layout/Container.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getBlog } from "@/utils/content";
import { Hash, ArrowLeft } from "@lucide/astro";

// 获取所有文章并统计标签
const posts = await getBlog();
const tagCounts = new Map<string, number>();

posts.forEach((post) => {
  post.data.tags?.forEach((tag) => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// 按文章数量排序标签
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="所有标签" description="浏览所有文章标签">
  <section class="py-16 sm:py-24">
    <Container size="sm">
      <!-- Page Header -->
      <div class="mb-10">
        <!-- 返回链接 -->
        <a
          href="/blog"
          class="mb-6 inline-flex items-center gap-2 text-muted-foreground transition-colors hover:text-foreground"
        >
          <ArrowLeft class="h-4 w-4" />
          <span>返回博客</span>
        </a>

        <h1 class="mb-2 text-2xl font-bold">所有标签</h1>
        <p class="text-muted-foreground">
          共 {sortedTags.length} 个标签
        </p>
      </div>

      <!-- Tags Grid -->
      {
        sortedTags.length > 0 ? (
          <div class="flex flex-wrap gap-3">
            {sortedTags.map(([tag, count]) => (
              <a
                href={`/tags/${tag}`}
                class="group inline-flex items-center gap-2 rounded-full border border-border bg-background px-4 py-2 transition-all hover:border-muted-foreground/50 hover:bg-muted"
              >
                <Hash class="h-4 w-4 text-muted-foreground group-hover:text-foreground" />
                <span class="text-foreground">{tag}</span>
                <span class="rounded-full bg-muted px-1.5 py-0.5 text-xs text-muted-foreground">{count}</span>
              </a>
            ))}
          </div>
        ) : (
          <div class="rounded-xl border border-dashed border-border py-16 text-center">
            <div class="space-y-3">
              <p class="text-muted-foreground">暂无标签</p>
            </div>
          </div>
        )
      }
    </Container>
  </section>
</BaseLayout>
