---
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogPostItem from "@/components/common/BlogPostItem.astro";
import { getCollection } from "astro:content";
import { getBlogPosts } from "@/utils/blog";

export async function getStaticPaths() {
  const categories = await getCollection("categories");

  return categories.map((category) => ({
    params: { slug: category.data.slug },
    props: { category },
  }));
}

const { category } = Astro.props;
const posts = (await getBlogPosts()).filter(
  (post) =>
    post.data.category === category.data.slug ||
    post.data.category === category.data.name,
);
const postCount = posts.length;
---

<BaseLayout
  title={`分类：${category.data.name} · chxuo.com`}
  description={category.data.description ||
    `分类「${category.data.name}」下的文章列表。`}
>
  <div class="mx-auto md:max-w-3xl">
    <section class="py-24 md:py-32">
      <div
        class="mb-8 flex flex-col justify-between gap-4 border-b border-border pb-6 md:flex-row md:items-end"
      >
        <div>
          <h1
            class="mb-2 font-serif text-3xl font-medium text-foreground md:text-4xl"
          >
            分类：{category.data.name}
          </h1>
          <p class="font-sans text-sm text-muted-foreground">
            {category.data.description || "这个分类下收录了一些相关的文章。"}
          </p>
        </div>
        <p class="font-mono text-xs text-muted-foreground/80">
          共 {postCount} 篇文章
        </p>
      </div>

      {
        postCount === 0 ? (
          <p class="text-sm text-muted-foreground">
            暂时还没有归档到这个分类的文章。
          </p>
        ) : (
          posts.map((post, index) => (
            <>
              <BlogPostItem post={post} />
              {index < posts.length - 1 && (
                <hr class="border-t border-border" />
              )}
            </>
          ))
        )
      }
    </section>
  </div>
</BaseLayout>
