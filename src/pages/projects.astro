---
import Container from "@/components/layout/Container.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getProjects } from "@/utils/content";
import { Github, ExternalLink, ArrowUpRight, Wrench } from "@lucide/astro";

const projects = await getProjects();
---

<BaseLayout title="项目" description="我折腾过的一些项目">
  <section class="py-16 sm:py-24">
    <Container size="sm">
      <!-- Page header -->
      <div class="mb-10">
        <h1 class="mb-2 text-2xl font-bold">项目</h1>
        <p class="text-muted-foreground">一些业余时间折腾的小项目</p>
      </div>

      <!-- Projects list -->
      <div class="space-y-4">
        {
          projects.length > 0 ? (
            projects.map((project) => (
              <article class="project-item group">
                <div class="flex items-start justify-between gap-4">
                  <div class="flex-1 space-y-2">
                    <div class="flex items-center gap-2">
                      <h2 class="text-lg font-semibold text-foreground transition-colors group-hover:text-primary">
                        {project.data.name}
                      </h2>
                      {project.data.status === "in-progress" && (
                        <span class="rounded-full bg-primary/10 px-2 py-0.5 text-xs text-primary">开发中</span>
                      )}
                      {project.data.status === "completed" && (
                        <span class="rounded-full bg-green-500/10 px-2 py-0.5 text-xs text-green-600 dark:text-green-400">
                          已完成
                        </span>
                      )}
                      {project.data.status === "archived" && (
                        <span class="rounded-full bg-muted px-2 py-0.5 text-xs text-muted-foreground">已归档</span>
                      )}
                    </div>

                    <p class="line-clamp-2 text-muted-foreground">{project.data.description}</p>

                    <div class="flex items-center gap-4 text-sm">
                      {/* Tech stack */}
                      {project.data.tech && (
                        <div class="flex items-center gap-2 text-muted-foreground/70">
                          {project.data.tech.slice(0, 4).map((tech: string, i: number) => (
                            <>
                              <span>{tech}</span>
                              {i < Math.min(3, project.data.tech.length - 1) && (
                                <span class="text-muted-foreground/30">·</span>
                              )}
                            </>
                          ))}
                          {project.data.tech.length > 4 && (
                            <>
                              <span class="text-muted-foreground/30">·</span>
                              <span>+{project.data.tech.length - 4}</span>
                            </>
                          )}
                        </div>
                      )}

                      {/* Separator */}
                      {project.data.tech && (project.data.github || project.data.demo) && (
                        <span class="text-muted-foreground/30">|</span>
                      )}

                      {/* Links */}
                      <div class="flex items-center gap-3">
                        {project.data.github && (
                          <a
                            href={project.data.github}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="flex items-center gap-1 text-muted-foreground/70 transition-colors hover:text-foreground"
                            aria-label="查看源代码"
                          >
                            <Github class="h-3 w-3" />
                            <span>源码</span>
                          </a>
                        )}
                        {project.data.demo && (
                          <a
                            href={project.data.demo}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="flex items-center gap-1 text-muted-foreground/70 transition-colors hover:text-foreground"
                            aria-label="查看演示"
                          >
                            <ExternalLink class="h-3 w-3" />
                            <span>演示</span>
                          </a>
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              </article>
            ))
          ) : (
            <div class="rounded-xl border border-dashed border-border py-16 text-center">
              <div class="space-y-3">
                <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-muted">
                  <Wrench class="h-6 w-6 text-muted-foreground" />
                </div>
                <p class="text-muted-foreground">还没有发布项目</p>
                <p class="text-sm text-muted-foreground/70">正在努力开发中...</p>
              </div>
            </div>
          )
        }
      </div>

      <!-- Stats -->
      {
        projects.length > 0 && (
          <footer class="mt-12 border-t border-border pt-8">
            <div class="flex items-center justify-center gap-8 text-sm text-muted-foreground">
              <div class="flex items-center gap-2">
                <span>共 {projects.length} 个项目</span>
              </div>
              <div class="flex items-center gap-2">
                <span>{projects.filter((p) => p.data.status === "in-progress").length} 个开发中</span>
              </div>
            </div>
          </footer>
        )
      }
    </Container>
  </section>
</BaseLayout>

<style>
  .project-item {
    padding-bottom: 1rem;
    border-bottom: 1px solid hsl(var(--border) / 0.3);
  }

  .project-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .project-item > div {
    position: relative;
  }

  .project-item > div::before {
    content: "";
    position: absolute;
    left: -1rem;
    right: -1rem;
    top: -0.5rem;
    bottom: -0.5rem;
    background: hsl(var(--muted) / 0);
    border-radius: 0.5rem;
    transition: background 0.2s ease;
    z-index: -1;
  }

  .project-item:hover > div::before {
    background: hsl(var(--muted) / 0.3);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media (max-width: 640px) {
    .project-item > div::before {
      left: -0.5rem;
      right: -0.5rem;
    }
  }
</style>
