---
import { getFeaturedProjects } from "@/utils/content";
import Container from "../layout/Container.astro";
import { Github, ExternalLink, ArrowUpRight } from "@lucide/astro";

const featuredProjects = await getFeaturedProjects();
---

<section class="pt-12 pb-16 sm:pt-16 sm:pb-20">
  <Container size="sm">
    <!-- Section header - matching blog section style -->
    <div class="mb-8">
      <h2 class="mb-2 text-2xl font-bold">精选项目</h2>
      <p class="text-muted-foreground">一些正在折腾的小玩意儿</p>
    </div>

    <!-- Projects list - similar to blog list style -->
    <div class="space-y-4">
      {
        featuredProjects.length > 0 ? (
          featuredProjects.map((project, index) => (
            <article class="project-item group">
              <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-2">
                  <div class="flex items-center gap-2">
                    <h3 class="text-lg font-semibold text-foreground transition-colors group-hover:text-primary">
                      {project.data.name}
                    </h3>
                    {project.data.status === "in-progress" && (
                      <span class="rounded-full bg-primary/10 px-2 py-0.5 text-xs text-primary">开发中</span>
                    )}
                  </div>

                  <p class="line-clamp-2 text-muted-foreground">{project.data.description}</p>

                  <div class="flex items-center gap-4 text-sm">
                    {/* Tech stack */}
                    {project.data.tech && (
                      <div class="flex items-center gap-2 text-muted-foreground/70">
                        {project.data.tech.slice(0, 3).map((tech: string, i: number) => (
                          <>
                            <span>{tech}</span>
                            {i < Math.min(2, project.data.tech.length - 1) && (
                              <span class="text-muted-foreground/30">·</span>
                            )}
                          </>
                        ))}
                        {project.data.tech.length > 3 && (
                          <>
                            <span class="text-muted-foreground/30">·</span>
                            <span>+{project.data.tech.length - 3}</span>
                          </>
                        )}
                      </div>
                    )}

                    {/* Separator */}
                    {project.data.tech && (project.data.github || project.data.demo) && (
                      <span class="text-muted-foreground/30">|</span>
                    )}

                    {/* Links */}
                    <div class="flex items-center gap-3">
                      {project.data.github && (
                        <a
                          href={project.data.github}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="flex items-center gap-1 text-muted-foreground/70 transition-colors hover:text-foreground"
                          aria-label="查看源代码"
                        >
                          <Github class="h-3 w-3" />
                          <span>源码</span>
                        </a>
                      )}
                      {project.data.demo && (
                        <a
                          href={project.data.demo}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="flex items-center gap-1 text-muted-foreground/70 transition-colors hover:text-foreground"
                          aria-label="查看演示"
                        >
                          <ExternalLink class="h-3 w-3" />
                          <span>演示</span>
                        </a>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            </article>
          ))
        ) : (
          <div class="py-12 text-center text-muted-foreground">
            <p class="mb-2">还没有发布项目</p>
            <p class="text-sm">正在准备一些有趣的作品...</p>
          </div>
        )
      }
    </div>

    <!-- View all link - matching blog style -->
    {
      featuredProjects.length > 0 && (
        <div class="mt-8 text-center">
          <a
            href="/projects"
            class="inline-flex items-center gap-2 text-muted-foreground transition-colors hover:text-foreground"
          >
            <span>查看全部项目</span>
            <ArrowUpRight class="h-4 w-4" />
          </a>
        </div>
      )
    }
  </Container>
</section>

<style>
  .project-item {
    padding-bottom: 1rem;
    border-bottom: 1px solid hsl(var(--border) / 0.3);
  }

  .project-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
  }

  .project-item > div {
    position: relative;
  }

  .project-item > div::before {
    content: "";
    position: absolute;
    left: -1rem;
    right: -1rem;
    top: -0.5rem;
    bottom: -0.5rem;
    background: hsl(var(--muted) / 0);
    border-radius: 0.5rem;
    transition: background 0.2s ease;
    z-index: -1;
  }

  .project-item:hover > div::before {
    background: hsl(var(--muted) / 0.3);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media (max-width: 640px) {
    .project-item > div::before {
      left: -0.5rem;
      right: -0.5rem;
    }
  }
</style>
