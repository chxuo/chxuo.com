---
import { navItems, siteConfig } from "@/config";
import NavLink from "./NavLink.astro";
import ThemeToggle from "../features/ThemeToggle.astro";
import { Menu, X } from "@lucide/astro";
import MobileMenu from "./MobileMenu.astro";
import Logo from "../ui/Logo.astro";

const currentPath = Astro.url.pathname;
---

<!-- border-b border-border -->
<header class="sticky top-0 z-50 w-full bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div class="container mx-auto flex h-16 items-center px-4 sm:px-6 lg:px-8">
    <div class="flex flex-1 items-center">
      <a href="/" class="group flex items-center space-x-2 transition-colors hover:text-primary">
        <Logo size="md" class="transition-transform group-hover:scale-110" />
        <h1 class="text-xl font-bold">{siteConfig.title}</h1>
      </a>
    </div>
    <nav class="hidden md:flex md:flex-2 md:items-center md:justify-center">
      <ul class="flex list-none items-center space-x-8">
        {
          navItems.map((item) => (
            <li>
              <NavLink
                href={item.href}
                isActive={currentPath === item.href || (item.href !== "/" && currentPath.startsWith(item.href))}
              >
                {item.name}
              </NavLink>
            </li>
          ))
        }
      </ul>
    </nav>

    <div class="flex flex-1 items-center justify-end space-x-4">
      <ThemeToggle />

      <button
        id="menu-toggle"
        type="button"
        class="inline-flex cursor-pointer items-center justify-center rounded-md p-2 text-foreground hover:bg-accent hover:text-accent-foreground md:hidden"
        aria-expanded="false"
      >
        <span class="sr-only">open menu</span>
        <Menu class="menu-open" />
        <X class="menu-close hidden" />
        <!-- <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
            class="menu-open"></path>
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="menu-close hidden"
          ></path>
        </svg> -->
      </button>
    </div>
  </div>

  <MobileMenu currentPath={currentPath} items={navItems} />
</header>

<script>
  document.addEventListener("astro:page-load", () => {
    const menuButton = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuOpenIcon = menuButton?.querySelector(".menu-open");
    const menuCloseIcon = menuButton?.querySelector(".menu-close");

    menuButton?.addEventListener("click", () => {
      const isExpanded = menuButton.getAttribute("aria-expanded") === "true";

      // toggle menu status
      menuButton.setAttribute("aria-expanded", (!isExpanded).toString());
      mobileMenu?.classList.toggle("hidden");

      // toggle icon
      menuOpenIcon?.classList.toggle("hidden");
      menuCloseIcon?.classList.toggle("hidden");
    });

    document.addEventListener("click", (event) => {
      const target = event.target as HTMLElement;
      if (!menuButton?.contains(target) && !mobileMenu?.contains(target) && !mobileMenu?.classList.contains("hidden")) {
        menuButton?.setAttribute("aria-expanded", "false");
        mobileMenu?.classList.add("hidden");
        menuOpenIcon?.classList.remove("hidden");
        menuCloseIcon?.classList.add("hidden");
      }
    });
  });
</script>
